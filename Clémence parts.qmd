---
title: "Clémence parts"
author: "HUANG Clémence"
format: html
editor: visual
---

# 1. Introduction

[Link to our github repository](https://github.com/clemence-code/Data_management_Project)

## 1.1 Description of the project - Research question

The objective of this project is to construct a climate vulnerability index that allows a systematic comparison of countries in terms of their vulnerability to climate change. Rather than relying on existing composite indicators, we propose to design our own multidimensional index built around three core dimensions widely used in the literature: Exposure, Sensitivity, and Adaptive Capacity. By explicitly combining these dimensions using transparent data and methods, we aim to better understand which structural factors drive a country’s vulnerability and to identify profiles of countries that may require differentiated policy responses. This leads us to the following research question: How can a composite climate vulnerability index be used to compare countries and support more targeted and equitable climate adaptation policies?

The first dimension, Exposure, measures the degree to which each country is physically exposed to climate-related hazards. In this project, exposure will be captured using indicators from the OECD and related sources that reflect the frequency and intensity of climate hazards, as well as the extent of populations and territories at risk. The guiding idea is that two countries may differ strongly in their baseline exposure even before considering their socio-economic characteristics or institutional responses.

The second dimension, Sensitivity, reflects how strongly a country’s society and economy are affected when a climate shock occurs. This dimension will incorporate a set of social and economic indicators such as poverty rates, the Human Development Index (HDI), governance quality, and measures of income inequality. Countries with high poverty, low human development, weak institutions, or high inequality may experience more severe impacts from the same physical shock. By integrating these variables, the index aims to capture how underlying socio-economic fragilities translate into greater climate vulnerability.

The third dimension, Adaptive Capacity, captures the ability of a country to anticipate, absorb, and recover from climate-related shocks. We will focus on indicators that proxy institutional strength, technological advancement and policy commitment, such as renewable energy production, the stringency and ambition of environmental policies, and public spending on environmental and climate-related research. The assumption is that higher adaptive capacity can mitigate the negative effects of exposure and sensitivity, reducing overall vulnerability even in high-risk contexts.

Methodologically, the project will involve selecting, normalising and aggregating indicators within each dimension, and then combining the three dimensions into a composite index of climate vulnerability. We will carefully examine correlations between variables to avoid redundancy and ensure that each indicator brings distinct information. Different weighting schemes (equal weights, data-driven weights, or robustness checks with alternative specifications) may be compared. Finally, the resulting index will be analysed descriptively to identify patterns of vulnerability across countries (for example, highly exposed but relatively resilient countries versus highly sensitive and poorly equipped ones).

## 1.2 Description of data sources
-   [OECD](https://www.oecd.org/en/data.html) : The Organisation for Economic Co-operation and Development (OECD), headquartered in Paris (France), is an international organisation of 38 member countries committed to democracy and the market economy. Its mission is to promote policies that foster sustainable economic growth, employment, rising living standards while supporting economic development worldwide. The OECD also plays a key role in producing harmonised, comparable statistics and indicators across countries.
    -   [Historical exposure to extreme temperatures (0ECD, 1979-2024)](https://data-explorer.oecd.org/vis?lc=en&df[ds]=dsDisseminateFinalDMZ&df[id]=DSD_ECH%40EXT_TEMP_H&df[ag]=OECD.ENV.EPI&df[vs]=2.0&dq=.A.HD_POP_EXP.........&pd=%2C&to[TIME_PERIOD]=false) For the temperature exposure data, we downloaded the series directly from the OECD Data Explorer by selecting the indicator “Historical exposure to extreme temperature” and country level data. The combined unit of measure was set to “percentage of population,” which yields the annual share of each country’s population exposed to days above 35°C. Using these filters, we obtained a dataset of 8 740 observations.
    - [Environmental Policy Stringency indicator (EPS)](https://data-explorer.oecd.org/vis?lc=en&tm=environmental%20policy&pg=0&snb=94&df%5bds%5d=dsDisseminateFinalDMZ&df%5bid%5d=DSD_EPS%40DF_EPS&df%5bag%5d=OECD.ECO.MAD&df%5bvs%5d=1.0&dq=.A..EPS&to%5bTIME_PERIOD%5d=false&pd=%2C&vw=tb)
    - [GDP expenditure on Research and Develoment](https://data-explorer.oecd.org/vis?lc=en&tm=msti&snb=1&vw=tb&df[ds]=dsDisseminateFinalDMZ&df[id]=DSD_MSTI%40DF_MSTI&df[ag]=OECD.STI.STP&df[vs]=&pd=1990%2C2024&dq=.A.G.PT_B1GQ..&to[TIME_PERIOD]=false)
-   [United Nations Development Programme (UNDP) - Human development Report Office](https://hdr.undp.org/) : UNDP is the UN’s global development network, working in around 170 countries and territories to eradicate poverty, reduce inequalities and build resilient institutions. Within UNDP, the Human Development Report Office (HDRO) is responsible for producing the annual Human Development Report and developing the Human Development Index (HDI) and related indicators, which provide a multidimensional view of development by combining health, education and income measures. [Index of Human Development (1990-2025)](https://hdr.undp.org/data-center/human-development-index#/indicies/HDI)
-   [World Inequality Database](https://wid.world/) : The World Inequality Lab is a research centre based at the Paris School of Economics, bringing together economists and social scientists to study global and national inequalities in income, wealth and carbon emissions. It manages and develops the World Inequality Database (WID.world), which compiles harmonised, long-run series on the distribution of income and wealth, based on a combination of tax data, national accounts, surveys and other sources, with the aim of informing public debate and policy on inequality. [Income share of the top 10% and top 10% carbon emitters (1980-2023)](https://wid.world/data/)
-   [IRENA](https://www.irena.org/) : IRENA is an intergovernmental agency that supports countries worldwide in their transition to a sustainable energy future by promoting renewable energy, providing data and analysis, and advising on energy policies and investments.[Electricity production from renewable sources (2000-2024)](https://pxweb.irena.org/pxweb/en/IRENASTAT)
-   [World bank](https://data.worldbank.org/) : The World Bank is an international financial institution headquartered in Washington, D.C., whose core mandate is to reduce poverty and promote sustainable development in low- and middle-income countries through financial support, technical assistance and policy advice. Beyond lending, the World Bank is one of the world’s main producers and disseminators of development statistics.
    -   [Per capita energy use (1990-2023)](https://data.worldbank.org/indicator/EG.USE.PCAP.KG.OE)

## 1.3 Description of the data file

### 1.3.0 Set up

```{r}
library(vroom)
library(here)
library(ggplot2)
library(dplyr)
library(readxl)
library(tidyr)
library(stringr)
```

```{r}
rm(list = ls())
here::i_am('Data_management_Project.Rproj')
```

```{r}
zip_files <- list.files(
  here::here("raw_data"),
  pattern = "\\.zip$",
  full.names = TRUE
)

target_dir <- here::here("data_file")

# We unzip the zipfile in raw_data only if this folder is empty, so the extraction runs only once
if (length(list.files(target_dir)) == 0) {
  for (f in zip_files) {
    unzip(f, exdir = target_dir)
  }
}
```

### 1.3.1 Historical exposure to extreme temperatures

The dataset we use reports, for each country and year, the share of the population exposed to “hot days”, defined as days when the daily maximum temperature exceeds 35°C.

We first import the Excel file while skipping the first six header lines. We then create a Duration variable from the rows starting with “Duration” and propagate it to all corresponding country rows. Next, we remove header rows, drop the last (non-informative) row, and delete any columns containing only missing values, resulting in a clean dataset structured by country and duration category.

```{r}
Temperature_exposure<-read_excel("raw_data/OECD.ENV.EPI,DSD_ECH@EXT_TEMP_H,2.0,filtered,2025-11-21 14-59-03.xlsx", skip=6)

Temperature_exposure_clean <- Temperature_exposure |>
  mutate(Duration = if_else(grepl("^Duration", `Time period...1`),
                            `Time period...1`, NA_character_)) |>
  fill(Duration) |>
  filter(`Time period...1` != "Reference area",
         !grepl("^Duration", `Time period...1`)) |>
  slice(-n()) |>
  select(where(~ !all(is.na(.))))
```

```{r}
Temperature_exposure_summary <- bind_rows(
  Temperature_exposure |>
    summarise(
      version = "Uncleaned",
      number_of_rows = n(),
      number_of_columns = ncol(across()),
      number_of_NA = sum(is.na(across()))
    ),
  Temperature_exposure_clean |>
    summarise(
      version = "Cleaned",
      number_of_rows = n(),
      number_of_columns = ncol(across()),
      number_of_NA = sum(is.na(across()))
    )
)

Temperature_exposure_summary |>
  knitr::kable(caption = "Summary of Temperature exposure dataset (raw vs cleaned)")

```

### 1.3.2 Human Development index

This dataset contains annual values of the Human Development Index for most countries from 1990 onwards, combining indicators of life expectancy, education and gross national income per capita. It provides a synthetic measure of socio-economic development and human capabilities, which can be used to approximate countries’ social vulnerability and resilience to climate impacts.

We first imported the HDI Excel file while skipping the first three header rows that contain only documentation. We then removed all observations for which the first column was missing, in order to drop non-country or descriptive rows. Finally, we deleted all variables with more than 20% missing values, keeping only columns with sufficient data coverage for the analysis.

```{r}
HDI <- read_excel("raw_data/HDR25_Statistical_Annex_HDI_Table.xlsx.", skip=3)

HDI_clean <- HDI[!is.na(HDI[[1]]), ] |>
  select(where(~ mean(is.na(.x)) <= 0.2))
```

```{r}
HDI_summary <- bind_rows(
  HDI |>
    summarise(
      version = "Uncleaned",
      number_of_rows = n(),
      number_of_columns = ncol(across()),
      number_of_NA = sum(is.na(across()))
    ),
  HDI_clean |>
    summarise(
      version = "Cleaned",
      number_of_rows = n(),
      number_of_columns = ncol(across()),
      number_of_NA = sum(is.na(across()))
    )
)

HDI_summary |>
  knitr::kable(caption = "Summary of HDI dataset (raw vs cleaned)")

```

### 1.3.3 Income share of the top 10%

This dataset offers long-run series on the income share captured by the top 10% of earners, as well as distributional information on the top 10% of carbon emitters within countries.

```{r}
Top_10_income_share <- vroom(here("data_file/WID_Data_Metadata", "WID_Data_21112025-154904.csv"), delim=";",skip=1)

Top_10_income_share_clean <- vroom(here("data_file/WID_Data_Metadata", "WID_Data_21112025-154904.csv"), delim=";",skip=1) |> select(-Percentile)

old_names <- names(Top_10_income_share_clean)
year_only <- str_extract(old_names, "\\d{4}")

# keep the year when it exists, otherwise keep the original name
names(Top_10_income_share_clean) <- ifelse(is.na(year_only), old_names, year_only)
```

```{r}
Top_10_income_share_summary <- dplyr::bind_rows(
  Top_10_income_share |>
    summarise(
      version         = "Uncleaned",
      number_of_rows  = n(),
      number_of_columns = ncol(across()),
      number_of_NA    = sum(is.na(across()))
    ),
  Top_10_income_share_clean |>
    summarise(
      version         = "Cleaned",
      number_of_rows  = n(),
      number_of_columns = ncol(across()),
      number_of_NA    = sum(is.na(across()))
    )
)

Top_10_income_share_summary |>
  knitr::kable(caption = "Summary of Top 10 income share dataset (raw vs cleaned)")

```

### 1.3.4 Environmental Policy Stringency

The EPS dataset reports, by country and year, an index of the stringency of environmental policies, constructed from information on instruments such as taxes, standards and regulations affecting pollution and energy use. The index ranges from very lax to very stringent policy environments.

We first removed all rows and columns that contained only missing values, then dropped the first row, the last row and the last column, which corresponded to non-informative metadata. We also deleted the aggregate line labelled “Non-OECD economies” to keep only country-level observations. Finally, we cleaned the country names in Time period...1 by removing leading symbols and extra spaces so that entries such as “·  Brazil” are standardised as “Brazil”.

```{r}
EPS_index <- read_excel("raw_data/OECD.ECO.MAD,DSD_EPS@DF_EPS,1.0,filtered,2025-11-19 13-27-34.xlsx", skip=6)

EPS_index_clean <- EPS_index |>
  filter(if_any(everything(), ~ !is.na(.))) |>
  select(where(~ !all(is.na(.)))) |>
  slice(-1) |>
  slice(-n()) |>
  select(-dplyr::last_col()) |>
  dplyr::filter(`Time period...1` != "Non-OECD economies")

EPS_index_clean <- EPS_index_clean |>
  mutate(`Time period...1` = `Time period...1` |>
           str_replace("^[^A-Za-z]+", "") |>
           str_squish())
```

```{r}
EPS_index_summary <- dplyr::bind_rows(
  EPS_index |>
    summarise(
      version          = "Uncleaned",
      number_of_rows   = n(),
      number_of_columns = ncol(across()),
      number_of_NA     = sum(is.na(across()))
    ),
  EPS_index_clean |>
    summarise(
      version          = "Cleaned",
      number_of_rows   = n(),
      number_of_columns = ncol(across()),
      number_of_NA     = sum(is.na(across()))
    )
)

EPS_index_summary |>
  knitr::kable(caption = "Summary of EPS index dataset (raw vs cleaned)")
```

### 1.3.5 Share of electricity from renewable resources

Ember’s yearly electricity dataset provides, for each country, the breakdown of electricity generation by source (coal, gas, nuclear, hydro, wind, solar, etc.), with a particular focus on renewable technologies. It enables the construction of indicators such as the share of renewables in electricity generation, which serve as proxies for the pace of the energy transition and adaptive capacity.

We first imported the Excel file while skipping the two initial header rows, then renamed the columns to country, indicator, year, and value for clarity. We filled down the country and indicator fields so that each observation has these identifiers, and removed rows where the year was missing. We then converted the year to an integer and transformed the values from character strings with commas into numeric variables. Finally, we kept only country-level observations by excluding regional aggregates such as World, Africa, Asia or Europe.

```{r}
Renew_Electricity_Share <- read_excel(here("raw_data/RESHARE_20251121-201530.xlsx"),skip=2)
```

```{r}
RE_clean <- Renew_Electricity_Share |>
  rename(
    country    = 1,
    indicator = 2,
    year      = 3,
    value     = 4
  ) |>
  fill(country, indicator, .direction = "down") |>
  filter(!is.na(year)) |>
  mutate(
    year  = as.integer(year),
    value = value |>
      as.character() |>
      str_replace(",", ".") |>
      as.numeric()
  )

RE_countries <- RE_clean |>
  filter(!grepl("World|Africa|Asia|Europe|America|Oceania|OECD|EU|Middle East|Eurasia",country))

```

```{r}
Renew_summary <- dplyr::bind_rows(
  Renew_Electricity_Share |>
    summarise(
      version          = "Uncleaned",
      number_of_rows   = n(),
      number_of_columns = ncol(across()),
      number_of_NA     = sum(is.na(across()))
    ),
  RE_countries |>
    summarise(
      version          = "Cleaned (countries only)",
      number_of_rows   = n(),
      number_of_columns = ncol(across()),
      number_of_NA     = sum(is.na(across()))
    )
)

Renew_summary |>
  knitr::kable(caption = "Summary of renewable electricity share dataset (raw vs cleaned)")
```

### 1.3.6 Per capita energy use

This World Bank indicator reports total primary energy consumption per capita, expressed in kilograms of oil equivalent, for a large set of countries over time.

```{r}
PC_Energy_Use <- vroom(
  here("data_file","API_EG.USE.ELEC.KH.PC_DS2_en_csv_v2_129274.csv"),
  delim = ",",
  skip = 4
) |>
  select(where(~ !all(is.na(.))))
```

```{r}
PC_Energy_Use |> 
  summarise(
    number_of_rows = n(),
    number_of_columns = ncol(across()),
    number_of_NA = sum(is.na(across()))
  ) |>
  knitr::kable()
```

### 1.3.7 Research and development as a share of GDP

This dataset provides annual data on gross domestic expenditure on research and development (GERD) as a percentage of GDP for many countries. It measures the scale of a country’s investment in innovation and knowledge creation, including in climate- and environment-related technologies, and is therefore a useful proxy for adaptive and transformative capacity.

```{r}
RD_share_of_GDP <- read_excel("raw_data/OECD.STI.STP,DSD_MSTI@DF_MSTI,,filtered,2025-11-21 21-55-03.xlsx",skip=3)

RD_share_of_GDP_clean <- RD_share_of_GDP |>
  slice(-1) |>
  slice(1:(n() - 2)) |>
  filter(if_any(everything(), ~ !is.na(.))) |>
  select(where(~ !all(is.na(.))))

RD_share_of_GDP_clean <- RD_share_of_GDP_clean |>
  dplyr::filter(
    !`Time period...1` %in% c(
      "European Union (27 countries from 01/02/2020)",
      "OECD",
      "Non-OECD economies"
    )
  )

RD_share_of_GDP_clean <- RD_share_of_GDP_clean |>
  mutate(`Time period...1` = `Time period...1` |>
           str_replace("^[^A-Za-z]+", "") |>
           str_squish())
```

```{r}
RD_summary <- dplyr::bind_rows(
  RD_share_of_GDP |>
    summarise(
      version           = "Uncleaned",
      number_of_rows    = n(),
      number_of_columns = ncol(across()),
      number_of_NA      = sum(is.na(across()))
    ),
  RD_share_of_GDP_clean |>
    summarise(
      version           = "Cleaned",
      number_of_rows    = n(),
      number_of_columns = ncol(across()),
      number_of_NA      = sum(is.na(across()))
    )
)

RD_summary |>
  knitr::kable(caption = "Summary of R&D share of GDP dataset (raw vs cleaned)")
```

### 1.3.8 ND-Gain vulnerability index

```{r}
vulnerability<- vroom(here("data_file/resources/vulnerability", "vulnerability.csv"))
```

```{r}
vulnerability |> 
  summarise(
    number_of_rows = n(),
    number_of_columns = ncol(across()),
    number_of_NA = sum(is.na(across()))
  ) |>
  knitr::kable()
```

### 1.3.9 CO2 emissions per capita

```{r}
CO2em<- vroom(here("raw_data", "yearly_full_release_long_format.csv"))
```

```{r}
CO2em|> 
  summarise(
    number_of_rows = n(),
    number_of_columns = ncol(across()),
    number_of_NA = sum(is.na(across()))
  ) |>
  knitr::kable()
```

### 1.3.10 World Development Indicator

```{r}
WDI<- read_excel("data_file/wgidataset.xlsx")
```

```{r}
WDI |> 
  summarise(
    number_of_rows = n(),
    number_of_columns = ncol(across()),
    number_of_NA = sum(is.na(across()))
  ) |>
  knitr::kable()
```

# 2. Data joining


